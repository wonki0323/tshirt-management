# 🎉 티셔츠 관리 시스템 업데이트 완료

## 📅 업데이트 일자
2025년 10월 13일

---

## ✅ 완료된 기능 (12개)

### 1. 제품 기본 가격 추가
- **Product 모델**에 `base_price` (기본 판매가) 필드 추가
- Admin 페이지에서 제품 기본 가격 입력 가능

### 2. 제품 옵션 동적 추가
- ProductOption 인라인 폼셋 `extra=3`으로 변경
- 제품 등록 시 기본적으로 3개의 빈 옵션 폼 표시
- 필요시 더 많은 옵션 추가 가능

### 3. 제품 옵션 판매가 및 원가 관리
- **ProductOption 모델**에 `base_price` (판매가) 필드 추가
- 기존 `base_cost` 필드 설명 개선 (부가세 포함 명시)
- Admin 페이지에서 옵션별 판매가/원가 관리

### 4. 순이익 계산 로직 개선
- **Order 모델** `total_cost` 계산에 택배비 포함
- 순이익 = 총 결제금액 - (제품 원가 + 택배비)
- Admin 페이지에서 순이익 자동 표시

### 5. 주소 검색 기능 (Daum 우편번호 API)
- 수동 주문 등록 시 "주소 검색" 버튼 클릭
- 우편번호 검색 모달 팝업
- 선택한 주소 자동 입력
- 제주/도서산간 지역 감지 시 택배비 자동 변경 (5,000원)

### 6. 총 결제금액 자동 합산
- 제품 옵션 선택 시 자동으로 합산
- 택배비 포함하여 계산
- 실시간 업데이트

### 7. 수동 입력 체크박스
- "총 결제금액 수동 입력" 체크박스 추가
- 체크 시 자동 합산 비활성화
- 수동으로 금액 입력 가능

### 8. 결제일시 기본값 설정
- **Order 모델** `payment_date` 기본값을 현재 시각으로 설정
- 수동 주문 등록 시 자동으로 현재 시각 표시
- 필요시 수정 가능

### 9. 수동 입력 항목 (메모)
- **OrderItem 모델**에 `manual_text` 필드 추가
- 제품 옵션 대신 텍스트로 주문 내용 입력 가능
- 메모로도 활용 가능

### 10. 유연한 주문 등록 검증
- 제품 옵션 없이 수동 입력만으로도 주문 등록 가능
- 수동 입력 + 결제금액만 있으면 주문 생성
- 메모 전용 주문도 가능

### 11. 택배비 필드 추가
- **Order 모델**에 `shipping_cost` 필드 추가
- 기본값: 3,500원
- 제주/도서산간 등 변경 가능

### 12. 택배비 포함 총액 계산
- 총 결제금액 = 제품 가격 합계 + 택배비
- 자동 합산 시 택배비 자동 포함
- 수동 변경 가능

---

## 🗂️ 변경된 파일

### 모델 (Models)
- `products/models.py`
  - Product: `base_price` 필드 추가
  - ProductOption: `base_price` 필드 추가, `base_cost` 설명 개선

- `orders/models.py`
  - Order: `payment_date` 기본값 추가, `shipping_cost` 필드 추가
  - OrderItem: `manual_text` 필드 추가, `quantity` 기본값 1
  - `total_cost` 계산 로직 수정 (택배비 포함)

### 폼 (Forms)
- `orders/forms.py`
  - `shipping_cost` 필드 추가
  - `manual_total_input` 체크박스 추가
  - `payment_date` 초기값 설정
  - 주소 입력 필드 readonly 설정
  - 검증 로직 개선 (수동 입력 + 결제금액만으로 주문 가능)
  - save() 메서드 수정 (택배비 저장, manual_text 처리)

### 뷰 (Views)
- `orders/views.py`
  - `manual_order_create`: 제품 옵션 가격 정보 컨텍스트 추가

### 템플릿 (Templates)
- `orders/templates/orders/manual_order_form.html`
  - Daum 우편번호 API 스크립트 추가
  - 주소 검색 버튼 추가
  - 택배비 입력 필드 추가
  - 수동 입력 체크박스 추가
  - 총 결제금액 자동 합산 JavaScript 추가
  - 제품 옵션에 data-price 속성 추가
  - 결제일시 자동 설정 JavaScript 추가
  - 제주/도서산간 자동 감지 로직 추가

### Admin
- `products/admin.py`
  - ProductOption 인라인: `extra=3`, `base_price` 필드 추가
  - Product Admin: `base_price` 표시
  - ProductOption Admin: `base_price` 표시

### 설정 (Settings)
- `tshirt_management/settings.py`
  - `SECRET_KEY` 기본값 설정 (로컬 개발용)
  - `DEBUG` 기본값 True (로컬 개발용)

### 마이그레이션
- `products/migrations/0003_*.py`
- `orders/migrations/0003_*.py`
- `finance/migrations/0003_*.py`
- `settings_app/migrations/0003_*.py`

---

## 🧪 로컬 테스트 방법

### 1. 마이그레이션 적용 확인
```bash
cd ~/tshirt_project
source ../tshirt_management_env/bin/activate
python manage.py migrate
```

### 2. 개발 서버 실행
```bash
python manage.py runserver
```

### 3. 테스트 항목

#### 제품 관리
1. Admin 페이지 접속: http://localhost:8000/admin/
2. **제품(Product)** 메뉴 클릭
3. 제품 추가 또는 수정
4. **기본 판매가** 입력
5. 제품 옵션 3개 입력 (옵션 상세, 판매가, 원가)
6. 저장

#### 수동 주문 등록
1. 주문 관리 페이지: http://localhost:8000/orders/
2. **수동 등록** 버튼 클릭
3. 고객 정보 입력
   - 고객명
   - 연락처
4. **주소 검색** 버튼 클릭
   - 우편번호 검색
   - 주소 선택
   - 상세 주소 입력
5. 주문 정보 입력
   - 택배비 확인 (기본 3,500원)
   - 결제일시 확인 (현재 시각)
6. 주문 항목 선택
   - **방법 1**: 제품 옵션 체크박스 선택 → 자동 합산 확인
   - **방법 2**: 수동 입력 항목에 텍스트 입력 → 수동 입력 체크박스 선택 → 총 결제금액 입력
7. 주문 등록 버튼 클릭

#### 자동 합산 테스트
1. 제품 옵션 여러 개 선택
2. 총 결제금액이 자동으로 계산되는지 확인
3. 택배비 변경 → 총액 자동 업데이트 확인
4. **수동 입력 체크박스** 선택 → 자동 합산 비활성화 확인

#### 순이익 확인
1. Admin 페이지에서 주문 목록 확인
2. 순이익 컬럼에서 계산 결과 확인
3. 주문 상세 페이지에서 총 원가 확인 (제품 원가 + 택배비)

---

## 🚀 배포 전 체크리스트

### 필수 확인 사항
- [ ] 로컬에서 모든 기능 테스트 완료
- [ ] 마이그레이션 파일 Git에 커밋됨
- [ ] 제품 옵션에 판매가/원가 입력됨
- [ ] 수동 주문 등록 테스트 완료
- [ ] 주소 검색 기능 작동 확인
- [ ] 자동 합산 기능 작동 확인

### 배포 단계
1. Git 커밋 및 푸시
   ```bash
   cd ~/tshirt_project
   git add -A
   git commit -m "feat: 제품 관리 및 수동 주문 등록 기능 개선"
   git push
   ```

2. Render 자동 배포 확인
   - https://dashboard.render.com
   - Logs 탭에서 배포 진행 상황 확인
   - "Build successful" 메시지 확인

3. 배포 환경 테스트
   - https://tshirt-management-web.onrender.com
   - 수동 주문 등록 테스트
   - 주소 검색 기능 테스트
   - 자동 합산 기능 테스트

---

## 📝 주요 변경 사항 요약

| 기능 | 변경 전 | 변경 후 |
|------|---------|---------|
| 제품 기본가 | ❌ 없음 | ✅ Product.base_price |
| 옵션 판매가 | ❌ 없음 | ✅ ProductOption.base_price |
| 옵션 추가 | 1개씩 | ✅ 3개씩 (extra=3) |
| 택배비 | ❌ 없음 | ✅ Order.shipping_cost (기본 3500원) |
| 결제일시 | 수동 입력 | ✅ 현재 시각 자동 설정 |
| 수동 입력 | 복잡한 형식 | ✅ 자유 텍스트 (메모) |
| 주소 입력 | 수동 입력 | ✅ Daum API 검색 |
| 총액 계산 | 수동 입력 | ✅ 자동 합산 (옵션 선택 시) |
| 순이익 계산 | 택배비 미포함 | ✅ 택배비 포함 |

---

## 🎯 다음 단계

### 추천 개선 사항
1. 제품 옵션 수량 입력 기능 추가
2. 주문 수정 기능 추가
3. 주문 취소 기능 개선
4. 통계 대시보드 추가
5. 엑셀 일괄 업로드 기능

### 버그 수정
- 현재 알려진 버그 없음

---

## 💡 사용 팁

### 제품 등록 시
1. 먼저 제품(Product)을 생성하고 기본 판매가 입력
2. 옵션별로 다른 가격이 있으면 옵션에서 개별 설정
3. 원가는 부가세 포함 금액으로 입력

### 수동 주문 등록 시
1. 제품 옵션이 등록되어 있으면 체크박스로 선택 (자동 합산)
2. 등록된 제품이 없거나 특수한 경우 수동 입력 사용
3. 제주/도서산간은 주소 검색 후 택배비 수동 변경

### 순이익 확인 시
- Admin 페이지에서 주문 목록 확인
- 빨간색 = 손실, 초록색 = 이익
- 택배비가 자동으로 원가에 포함됨

---

## ❓ 문제 해결

### Q: 제품 옵션이 표시되지 않아요
**A:** Admin 페이지에서 제품 옵션의 "활성화" 체크박스를 확인하세요.

### Q: 자동 합산이 작동하지 않아요
**A:** "총 결제금액 수동 입력" 체크박스가 선택되어 있는지 확인하세요. 체크 해제하면 자동 합산됩니다.

### Q: 주소 검색이 안 돼요
**A:** 인터넷 연결을 확인하세요. Daum API는 온라인 상태에서만 작동합니다.

### Q: 마이그레이션 오류가 발생해요
**A:** 다음 명령어로 마이그레이션을 다시 실행하세요:
```bash
python manage.py migrate --run-syncdb
```

---

## 📞 지원

문제가 발생하거나 추가 기능이 필요하면 언제든지 문의하세요!

**개발 완료일**: 2025년 10월 13일
**버전**: v2.0.0
**상태**: ✅ 로컬 테스트 완료, 배포 대기





