{% extends "base.html" %}

{% block title %}API ì„¤ì •{% endblock %}

{% block content %}
<div class="container">
    <h1 class="mb-4">API ì„¤ì •</h1>
    
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">API í‚¤ ë° ì„¤ì • ê´€ë¦¬</h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        
                        <div class="mb-3">
                            <label for="name" class="form-label">ì„¤ì •ëª…</label>
                            <input type="text" class="form-control" id="name" name="name" 
                                   value="{{ settings.name|default:'API ì„¤ì •' }}" required>
                        </div>
                        
                        <h6 class="mt-4 mb-3">Google Drive ì„¤ì •</h6>
                        
                        <div class="mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="use_oauth" name="use_oauth" 
                                       {% if settings.use_oauth %}checked{% endif %}>
                                <label class="form-check-label" for="use_oauth">
                                    <strong>OAuth 2.0 ì‚¬ìš©</strong> (ê¶Œì¥)
                                </label>
                            </div>
                            <div class="form-text">
                                OAuth 2.0ì„ ì‚¬ìš©í•˜ë©´ ì‚¬ìš©ì ê³„ì •ìœ¼ë¡œ ì§ì ‘ ì—…ë¡œë“œí•˜ì—¬ ì„œë¹„ìŠ¤ ê³„ì •ì˜ ìŠ¤í† ë¦¬ì§€ ì œí•œ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                            </div>
                        </div>
                        
                        <div class="mb-3" id="oauth-settings" style="display: {% if settings.use_oauth %}block{% else %}none{% endif %};">
                            <label for="oauth_credentials_path" class="form-label">OAuth 2.0 Credentials JSON íŒŒì¼ ê²½ë¡œ</label>
                            <input type="text" class="form-control" id="oauth_credentials_path" 
                                   name="oauth_credentials_path" 
                                   value="{{ settings.oauth_credentials_path|default:'' }}"
                                   placeholder="/Users/wonkikim/Downloads/oauth2_credentials.json">
                            <div class="form-text">
                                <strong>ì„¤ì • ë°©ë²•:</strong><br>
                                1. Google Cloud Console â†’ OAuth 2.0 í´ë¼ì´ì–¸íŠ¸ ID ìƒì„±<br>
                                2. ì• í”Œë¦¬ì¼€ì´ì…˜ ìœ í˜•: "ë°ìŠ¤í¬í†± ì•±"<br>
                                3. JSON ë‹¤ìš´ë¡œë“œ í›„ ê²½ë¡œ ì…ë ¥<br>
                                <a href="/OAUTH2_SETUP_GUIDE.md" target="_blank" class="btn btn-sm btn-info mt-2">
                                    ğŸ“– ìƒì„¸ ì„¤ì • ê°€ì´ë“œ ë³´ê¸°
                                </a>
                            </div>
                        </div>
                        
                        <div class="mb-3" id="service-account-settings" style="display: {% if not settings.use_oauth %}block{% else %}none{% endif %};">
                            <label for="google_drive_credentials_path" class="form-label">ì„œë¹„ìŠ¤ ê³„ì • í‚¤ íŒŒì¼ ê²½ë¡œ (ë ˆê±°ì‹œ)</label>
                            <input type="text" class="form-control" id="google_drive_credentials_path" 
                                   name="google_drive_credentials_path" 
                                   value="{{ settings.google_drive_credentials_path|default:'' }}"
                                   placeholder="/path/to/credentials.json">
                            <div class="form-text text-warning">
                                âš ï¸ ì„œë¹„ìŠ¤ ê³„ì •ì€ ìŠ¤í† ë¦¬ì§€ ì œí•œì´ ìˆì–´ íŒŒì¼ ì—…ë¡œë“œê°€ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. OAuth 2.0 ì‚¬ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤.
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="google_drive_parent_folder_id" class="form-label">ìƒìœ„ í´ë” ID</label>
                            <input type="text" class="form-control" id="google_drive_parent_folder_id" 
                                   name="google_drive_parent_folder_id" 
                                   value="{{ settings.google_drive_parent_folder_id|default:'' }}"
                                   placeholder="1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms">
                            <div class="form-text">
                                <strong>í´ë” ID í™•ì¸ ë°©ë²•:</strong><br>
                                1. Google Driveì—ì„œ í´ë” ì—´ê¸°<br>
                                2. ë¸Œë¼ìš°ì € ì£¼ì†Œì°½ì˜ URL í™•ì¸<br>
                                3. <code>https://drive.google.com/drive/folders/<strong>í´ë”ID</strong></code><br>
                                4. í´ë”ID ë¶€ë¶„ì„ ë³µì‚¬í•˜ì—¬ ì…ë ¥<br>
                                <span class="text-danger">âš ï¸ "admin"ì´ ì•„ë‹Œ ì‹¤ì œ í´ë” IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!</span>
                            </div>
                        </div>
                        
                        <h6 class="mt-4 mb-3">ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ ì„¤ì •</h6>
                        <div class="mb-3">
                            <label for="smartstore_client_id" class="form-label">í´ë¼ì´ì–¸íŠ¸ ID</label>
                            <input type="text" class="form-control" id="smartstore_client_id" 
                                   name="smartstore_client_id" 
                                   value="{{ settings.smartstore_client_id|default:'' }}"
                                   placeholder="your_client_id">
                        </div>
                        
                        <div class="mb-3">
                            <label for="smartstore_client_secret" class="form-label">í´ë¼ì´ì–¸íŠ¸ ì‹œí¬ë¦¿</label>
                            <input type="password" class="form-control" id="smartstore_client_secret" 
                                   name="smartstore_client_secret" 
                                   value="{{ settings.smartstore_client_secret|default:'' }}"
                                   placeholder="your_client_secret">
                        </div>
                        
                        <div class="d-flex justify-content-between">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>ì„¤ì • ì €ì¥
                            </button>
                            <a href="{% url 'dashboard' %}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left me-2"></i>ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0">ì„¤ì • ê°€ì´ë“œ</h6>
                </div>
                <div class="card-body">
                    <h6>Google Drive ì„¤ì •</h6>
                    <ol class="small">
                        <li>Google Cloud Consoleì—ì„œ í”„ë¡œì íŠ¸ ìƒì„±</li>
                        <li>Drive API í™œì„±í™”</li>
                        <li>ì„œë¹„ìŠ¤ ê³„ì • ìƒì„± ë° í‚¤ ë‹¤ìš´ë¡œë“œ</li>
                        <li>í‚¤ íŒŒì¼ ê²½ë¡œë¥¼ ìœ„ ì…ë ¥ë€ì— ì…ë ¥</li>
                        <li>í´ë” IDëŠ” Google Drive URLì—ì„œ í™•ì¸</li>
                    </ol>
                    
                    <h6 class="mt-3">ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ ì„¤ì •</h6>
                    <ol class="small">
                        <li>ë„¤ì´ë²„ ê°œë°œìì„¼í„°ì—ì„œ ì•± ë“±ë¡</li>
                        <li>ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ API ê¶Œí•œ ì‹ ì²­</li>
                        <li>í´ë¼ì´ì–¸íŠ¸ IDì™€ ì‹œí¬ë¦¿ ë°œê¸‰</li>
                        <li>ìœ„ ì…ë ¥ë€ì— ì…ë ¥</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const useOauthCheckbox = document.getElementById('use_oauth');
    const oauthSettings = document.getElementById('oauth-settings');
    const serviceAccountSettings = document.getElementById('service-account-settings');
    
    useOauthCheckbox.addEventListener('change', function() {
        if (this.checked) {
            oauthSettings.style.display = 'block';
            serviceAccountSettings.style.display = 'none';
        } else {
            oauthSettings.style.display = 'none';
            serviceAccountSettings.style.display = 'block';
        }
    });
});
</script>
{% endblock %}

